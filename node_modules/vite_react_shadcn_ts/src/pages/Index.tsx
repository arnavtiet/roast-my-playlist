import { useState } from "react";
import { PlaylistInput } from "@/components/PlaylistInput";
import { RoastCard } from "@/components/RoastCard";
import { FloatingEmoji } from "@/components/FloatingEmoji";
import { RoastIntensitySlider, RoastLevel } from "@/components/RoastIntensitySlider";
import { Music2, Sparkles } from "lucide-react";

const Index = () => {
  const [roast, setRoast] = useState("");
  const [isLoading, setIsLoading] = useState(false);
  const [roastLevel, setRoastLevel] = useState<RoastLevel>("medium");

  const handleSubmit = async (url: string, level: RoastLevel) => {
    setIsLoading(true);
    setRoast("");

    try {
      const response = await fetch('/api/roast', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ playlistUrl: url, roastLevel: level }),
      });

      const data = await response.json();

      if (!response.ok) {
        throw new Error(data.message || 'Failed to roast playlist');
      }

      setRoast(data.roast);
    } catch (error) {
      console.error('Error roasting playlist:', error);
      setRoast(
        "oops bestie ðŸ˜­ something went wrong while roasting your playlist. make sure the URL is valid and try again!"
      );
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <main className="relative min-h-screen bg-background overflow-hidden">
      {/* Background gradient */}
      <div className="absolute inset-0 bg-gradient-to-br from-background via-background to-muted/20" />

      {/* Floating emojis */}
      <FloatingEmoji emoji="ðŸŽµ" className="top-20 left-[10%]" delay={0} />
      <FloatingEmoji emoji="ðŸ”¥" className="top-32 right-[15%]" delay={0.5} />
      <FloatingEmoji emoji="ðŸ’€" className="top-[40%] left-[5%]" delay={1} />
      <FloatingEmoji emoji="ðŸ˜­" className="top-[50%] right-[8%]" delay={1.5} />
      <FloatingEmoji emoji="âœ¨" className="bottom-32 left-[12%]" delay={2} />
      <FloatingEmoji emoji="ðŸŽ§" className="bottom-20 right-[10%]" delay={0.3} />

      {/* Content */}
      <div className="relative z-10 container mx-auto px-4 py-12 md:py-20">
        {/* Header */}
        <header className="text-center mb-12 md:mb-16">
          <div className="inline-flex items-center gap-2 px-4 py-2 bg-card rounded-full border border-border mb-6">
            <Music2 className="w-4 h-4 text-primary" />
            <span className="text-sm text-muted-foreground">powered by AI that has zero chill</span>
            <Sparkles className="w-4 h-4 text-secondary" />
          </div>

          <h1 className="text-5xl md:text-7xl lg:text-8xl font-black mb-4 tracking-tight">
            <span className="gradient-text">SPOTIFY</span>
            <br />
            <span className="text-foreground">PLAYLIST</span>
            <br />
            <span className="gradient-text-alt neon-glow-pink">ROASTER</span>
          </h1>

          <p className="text-lg md:text-xl text-muted-foreground max-w-md mx-auto mt-6">
            drop your playlist link and let AI expose your{" "}
            <span className="text-secondary font-semibold">questionable</span> music taste
          </p>
        </header>

        {/* Roast Intensity Slider */}
        <section className="mb-8">
          <RoastIntensitySlider value={roastLevel} onChange={setRoastLevel} />
        </section>

        {/* Input Section */}
        <section className="mb-8">
          <PlaylistInput onSubmit={handleSubmit} isLoading={isLoading} roastLevel={roastLevel} />
        </section>

        {/* Roast Display */}
        <section>
          <RoastCard roast={roast} isLoading={isLoading} />
        </section>

        {/* Footer */}
        <footer className="mt-16 md:mt-24 text-center">
          <p className="text-muted-foreground text-sm">
            made with ðŸ’… and absolutely no respect for your music taste
          </p>
          <div className="mt-4 flex items-center justify-center gap-4 text-xs text-muted-foreground/60">
            <span>not affiliated with Spotify</span>
            <span className="text-primary">â€¢</span>
            <span>all roasts are AI-generated</span>
          </div>
        </footer>
      </div>

      {/* Decorative corner elements */}
      <div className="fixed top-0 left-0 w-32 h-32 bg-gradient-to-br from-primary/20 to-transparent blur-3xl" />
      <div className="fixed top-0 right-0 w-32 h-32 bg-gradient-to-bl from-secondary/20 to-transparent blur-3xl" />
      <div className="fixed bottom-0 left-0 w-32 h-32 bg-gradient-to-tr from-accent/20 to-transparent blur-3xl" />
      <div className="fixed bottom-0 right-0 w-32 h-32 bg-gradient-to-tl from-primary/20 to-transparent blur-3xl" />
    </main>
  );
};

export default Index;
